<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Анализ матча</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* Сброс */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background: #000;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      height: 100vh;
      overflow: hidden;
      touch-action: none;
    }

    /* Экран поворота */
    #rotateScreen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
      padding: 20px;
      background: #111;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
    }

    /* Основной интерфейс */
    #mainInterface {
      display: none;
      height: 100vh;
      position: relative;
    }

    /* Индикатор записи */
    #recordingIndicator {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(198, 40, 40, 0.9);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      z-index: 50;
      display: none;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .recordingDot {
      width: 10px;
      height: 10px;
      background: #ff4444;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 0.3; }
      50% { opacity: 1; }
      100% { opacity: 0.3; }
    }

    /* Таймер записи */
    #recordingTimer {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      z-index: 50;
      display: none;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Контейнер для видео */
    #videoContainer {
      width: 100%;
      height: 70vh; /* Начальная высота */
      background: #000;
      position: relative;
      transition: height 0.3s ease;
      overflow: hidden;
    }

    #videoFrame {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }

    /* Управление */
    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 40;
    }

    .control-btn {
      padding: 14px 28px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      color: white;
      min-width: 140px;
      transition: all 0.2s;
    }

    #startBtn { 
      background: linear-gradient(135deg, #2e7d32, #4caf50);
    }

    #startBtn:disabled {
      background: #555;
      cursor: not-allowed;
      opacity: 0.6;
    }

    #stopBtn { 
      background: linear-gradient(135deg, #c62828, #f44336);
      display: none;
    }

    .control-btn:active:not(:disabled) {
      transform: scale(0.95);
    }

    /* Разделитель между видео и схемой */
    #divider {
      position: absolute;
      left: 0;
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.3);
      cursor: ns-resize;
      z-index: 60;
      transition: background 0.2s;
    }

    #divider:hover {
      background: rgba(255, 255, 255, 0.6);
    }

    #dividerHandle {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 24px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #dividerHandle::after {
      content: "";
      width: 20px;
      height: 3px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 2px;
    }

    /* Панель со схемой (Bottom Sheet) */
    #fieldPanel {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 30vh; /* Начальная высота */
      background: #1a237e;
      z-index: 30;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      overflow: hidden;
      display: none;
      box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.5);
      transition: height 0.3s ease;
    }

    /* Контейнер для схемы */
    #fieldContainer {
      width: 100%;
      height: 100%;
      position: relative;
      touch-action: none;
    }

    /* Схема поля (КХЛ) */
    #hockeyField {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Активная точка */
    .marker-point {
      position: absolute;
      width: 24px;
      height: 24px;
      background: #FF0000;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
      transform: translate(-50%, -50%);
      z-index: 100;
      cursor: move;
      transition: transform 0.1s;
      pointer-events: auto;
    }

    .marker-point.dragging {
      transform: translate(-50%, -50%) scale(1.2);
      z-index: 101;
      box-shadow: 0 0 20px rgba(255, 0, 0, 1);
    }

    /* Инструкция */
    #instruction {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      z-index: 45;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-align: center;
      max-width: 90%;
      display: none;
    }

    /* Кнопка закрытия схемы */
    #closeFieldBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      z-index: 45;
      backdrop-filter: blur(10px);
      transition: all 0.2s;
    }

    #closeFieldBtn:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <!-- Экран поворота -->
  <div id="rotateScreen">
    <svg viewBox="0 0 24 24" fill="white" width="60" height="60">
      <path d="M19 12h-1.5c-.82 0-1.5-.68-1.5-1.5V5.5C16 4.67 16.67 4 17.5 4H19c.83 0 1.5.67 1.5 1.5v3.5c0 .83-.67 1.5-1.5 1.5H1L1.01 21c0 1.1.89 2 2 2H21c1.1 0 2-.9 2-2L22.99 14H19zm-5.5-9H8.5V8h4V4zm6 14H2v2h18v-2z"/>
    </svg>
    <p style="margin-top: 20px;">Пожалуйста, поверните устройство в горизонтальное положение.</p>
  </div>

  <!-- Основной интерфейс -->
  <div id="mainInterface">
    <!-- Индикатор записи -->
    <div id="recordingIndicator">
      <div class="recordingDot"></div>
      <span>Идет запись</span>
    </div>

    <!-- Таймер записи -->
    <div id="recordingTimer">00:00:00</div>

    <!-- Контейнер для видео -->
    <div id="videoContainer">
      <iframe id="videoFrame" allowfullscreen></iframe>
    </div>

    <!-- Разделитель -->
    <div id="divider" style="display: none;">
      <div id="dividerHandle"></div>
    </div>

    <!-- Панель со схемой -->
    <div id="fieldPanel">
      <div id="instruction">Нажмите на поле, чтобы поставить точку. Нажмите на точку, чтобы перетащить</div>
      <button id="closeFieldBtn">Скрыть схему</button>
      <div id="fieldContainer">
        <svg id="hockeyField" viewBox="0 0 200 85" xmlns="http://www.w3.org/2000/svg">
          <!-- Лёд -->
          <rect width="200" height="85" fill="#87CEEB"/>
          
          <!-- Борта (красные) -->
          <rect x="0" y="0" width="200" height="85" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          
          <!-- Центральная красная линия -->
          <line x1="100" y1="0" x2="100" y2="85" stroke="#FF0000" stroke-width="1"/>
          
          <!-- Центральный круг -->
          <circle cx="100" cy="42.5" r="15" fill="none" stroke="#FF0000" stroke-width="1"/>
          <circle cx="100" cy="42.5" r="0.5" fill="#FF0000"/>
          
          <!-- Синие линии -->
          <rect x="25" y="0" width="1" height="85" fill="#0000FF"/>
          <rect x="174" y="0" width="1" height="85" fill="#0000FF"/>
          
          <!-- Зоны ворот -->
          <rect x="0" y="30" width="11" height="25" fill="none" stroke="#000000" stroke-width="1"/>
          <rect x="189" y="30" width="11" height="25" fill="none" stroke="#000000" stroke-width="1"/>
          
          <!-- Круги вбрасывания -->
          <!-- Центральный -->
          <circle cx="100" cy="42.5" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          
          <!-- В зонах -->
          <circle cx="25" cy="42.5" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          <circle cx="175" cy="42.5" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          
          <!-- В зоне защиты слева -->
          <circle cx="25" cy="20" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          <circle cx="25" cy="65" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          
          <!-- В зоне защиты справа -->
          <circle cx="175" cy="20" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          <circle cx="175" cy="65" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          
          <!-- В зоне атаки слева -->
          <circle cx="60" cy="20" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          <circle cx="60" cy="65" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          
          <!-- В зоне атаки справа -->
          <circle cx="140" cy="20" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          <circle cx="140" cy="65" r="3" fill="none" stroke="#FF0000" stroke-width="0.5"/>
          
          <!-- Точки вбрасывания (белые) -->
          <circle cx="100" cy="42.5" r="0.5" fill="white"/>
          <circle cx="25" cy="42.5" r="0.5" fill="white"/>
          <circle cx="175" cy="42.5" r="0.5" fill="white"/>
          <circle cx="25" cy="20" r="0.5" fill="white"/>
          <circle cx="25" cy="65" r="0.5" fill="white"/>
          <circle cx="175" cy="20" r="0.5" fill="white"/>
          <circle cx="175" cy="65" r="0.5" fill="white"/>
          <circle cx="60" cy="20" r="0.5" fill="white"/>
          <circle cx="60" cy="65" r="0.5" fill="white"/>
          <circle cx="140" cy="20" r="0.5" fill="white"/>
          <circle cx="140" cy="65" r="0.5" fill="white"/>
        </svg>
        <!-- Здесь будет появляться точка -->
      </div>
    </div>

    <!-- Управление -->
    <div id="controls">
      <button id="startBtn" class="control-btn" disabled>Начать запись</button>
      <button id="stopBtn" class="control-btn">Стоп</button>
    </div>
  </div>

  <script>
    // Инициализация Telegram Web App
    if (window.Telegram?.WebApp) {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
    }

    // Элементы
    const rotateScreen = document.getElementById('rotateScreen');
    const mainInterface = document.getElementById('mainInterface');
    const videoFrame = document.getElementById('videoFrame');
    const videoContainer = document.getElementById('videoContainer');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const fieldPanel = document.getElementById('fieldPanel');
    const fieldContainer = document.getElementById('fieldContainer');
    const hockeyField = document.getElementById('hockeyField');
    const recordingIndicator = document.getElementById('recordingIndicator');
    const recordingTimer = document.getElementById('recordingTimer');
    const divider = document.getElementById('divider');
    const instruction = document.getElementById('instruction');
    const closeFieldBtn = document.getElementById('closeFieldBtn');

    // Переменные состояния
    let isRecording = false;
    let recordingStartTime = null;
    let timerInterval = null;
    let events = [];
    
    // Для работы с точкой
    let currentMarker = null;
    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    let markerStartX = 0;
    let markerStartY = 0;
    
    // Для работы с разделителем
    let isResizing = false;
    let startHeight = 0;
    let startY = 0;
    const minVideoHeight = 30; // минимальная высота видео в %
    const maxVideoHeight = 90; // максимальная высота видео в %

    // Параметры из URL
    const urlParams = new URLSearchParams(window.location.search);
    const videoUrl = urlParams.get('video');
    const date = urlParams.get('date');
    const opponent = urlParams.get('opponent');
    const iceTime = urlParams.get('ice_time');

    // Загружаем видео
    if (videoUrl) {
      let finalUrl = videoUrl;
      
      // YouTube
      if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
        let videoId;
        if (videoUrl.includes('youtu.be/')) {
          videoId = videoUrl.split('youtu.be/')[1].split('?')[0];
        } else {
          videoId = videoUrl.split('v=')[1]?.split('&')[0];
        }
        if (videoId) {
          finalUrl = `https://www.youtube.com/embed/${videoId}?autoplay=0&rel=0&controls=1&enablejsapi=1`;
        }
      }
      // Vimeo
      else if (videoUrl.includes('vimeo.com')) {
        const vimeoId = videoUrl.split('/').pop();
        finalUrl = `https://player.vimeo.com/video/${vimeoId}?autoplay=0`;
      }
      
      videoFrame.src = finalUrl;
    }

    // Проверка ориентации
    function checkOrientation() {
      const isLandscape = window.innerWidth > window.innerHeight;
      rotateScreen.style.display = isLandscape ? 'none' : 'flex';
      mainInterface.style.display = isLandscape ? 'block' : 'none';
    }

    window.addEventListener('resize', checkOrientation);
    checkOrientation();

    // Форматирование времени
    function formatTime(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      
      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // Обновление таймера
    function updateTimer() {
      if (recordingStartTime) {
        const elapsed = Date.now() - recordingStartTime;
        recordingTimer.textContent = formatTime(elapsed);
      }
    }

    // Создание точки
    function createMarker(x, y) {
      // Удаляем старую точку, если есть
      if (currentMarker) {
        currentMarker.remove();
      }
      
      // Создаем новую точку
      currentMarker = document.createElement('div');
      currentMarker.className = 'marker-point';
      currentMarker.style.left = x + 'px';
      currentMarker.style.top = y + 'px';
      
      // Добавляем обработчики для перетаскивания
      currentMarker.addEventListener('mousedown', startDrag);
      currentMarker.addEventListener('touchstart', startDragTouch);
      
      // Добавляем на схему
      fieldContainer.appendChild(currentMarker);
      
      console.log('Точка создана в позиции:', {x, y});
    }

    // Начало перетаскивания (мышь)
    function startDrag(e) {
      e.preventDefault();
      e.stopPropagation();
      
      isDragging = true;
      currentMarker.classList.add('dragging');
      
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      markerStartX = currentMarker.offsetLeft;
      markerStartY = currentMarker.offsetTop;
      
      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', stopDrag);
    }

    // Начало перетаскивания (тач)
    function startDragTouch(e) {
      e.preventDefault();
      e.stopPropagation();
      
      if (e.touches.length !== 1) return;
      
      isDragging = true;
      currentMarker.classList.add('dragging');
      
      const touch = e.touches[0];
      dragStartX = touch.clientX;
      dragStartY = touch.clientY;
      markerStartX = currentMarker.offsetLeft;
      markerStartY = currentMarker.offsetTop;
      
      document.addEventListener('touchmove', dragTouch);
      document.addEventListener('touchend', stopDragTouch);
    }

    // Перетаскивание (мышь)
    function drag(e) {
      if (!isDragging) return;
      
      const deltaX = e.clientX - dragStartX;
      const deltaY = e.clientY - dragStartY;
      
      const newX = markerStartX + deltaX;
      const newY = markerStartY + deltaY;
      
      // Ограничиваем перемещение в пределах схемы
      const fieldRect = fieldContainer.getBoundingClientRect();
      const maxX = fieldRect.width;
      const maxY = fieldRect.height;
      
      const clampedX = Math.max(0, Math.min(newX, maxX));
      const clampedY = Math.max(0, Math.min(newY, maxY));
      
      currentMarker.style.left = clampedX + 'px';
      currentMarker.style.top = clampedY + 'px';
    }

    // Перетаскивание (тач)
    function dragTouch(e) {
      if (!isDragging || e.touches.length !== 1) return;
      
      const touch = e.touches[0];
      const deltaX = touch.clientX - dragStartX;
      const deltaY = touch.clientY - dragStartY;
      
      const newX = markerStartX + deltaX;
      const newY = markerStartY + deltaY;
      
      // Ограничиваем перемещение в пределах схемы
      const fieldRect = fieldContainer.getBoundingClientRect();
      const maxX = fieldRect.width;
      const maxY = fieldRect.height;
      
      const clampedX = Math.max(0, Math.min(newX, maxX));
      const clampedY = Math.max(0, Math.min(newY, maxY));
      
      currentMarker.style.left = clampedX + 'px';
      currentMarker.style.top = clampedY + 'px';
    }

    // Остановка перетаскивания (мышь)
    function stopDrag() {
      isDragging = false;
      if (currentMarker) {
        currentMarker.classList.remove('dragging');
      }
      
      document.removeEventListener('mousemove', drag);
      document.removeEventListener('mouseup', stopDrag);
      
      console.log('Точка перемещена в позицию:', {
        x: currentMarker.offsetLeft,
        y: currentMarker.offsetTop
      });
    }

    // Остановка перетаскивания (тач)
    function stopDragTouch() {
      isDragging = false;
      if (currentMarker) {
        currentMarker.classList.remove('dragging');
      }
      
      document.removeEventListener('touchmove', dragTouch);
      document.removeEventListener('touchend', stopDragTouch);
    }

    // Обработка кликов по схеме
    function handleFieldClick(e) {
      // Если кликнули по точке, не создаем новую
      if (e.target.classList.contains('marker-point')) {
        return;
      }
      
      // Получаем координаты клика относительно схемы
      const rect = fieldContainer.getBoundingClientRect();
      let x, y;
      
      if (e.type === 'click' || e.type === 'mousedown') {
        x = e.clientX - rect.left;
        y = e.clientY - rect.top;
      } else if (e.type === 'touchstart') {
        const touch = e.touches[0];
        x = touch.clientX - rect.left;
        y = touch.clientY - rect.top;
      }
      
      // Создаем или перемещаем точку
      if (currentMarker) {
        // Перемещаем существующую точку
        currentMarker.style.left = x + 'px';
        currentMarker.style.top = y + 'px';
        console.log('Точка перемещена в:', {x, y});
      } else {
        // Создаем новую точку
        createMarker(x, y);
      }
    }

    // Показ схемы поля
    function showField() {
      // Останавливаем видео
      if (videoFrame.contentWindow) {
        try {
          videoFrame.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
        } catch (e) {}
      }
      
      // Показываем панель со схемой
      fieldPanel.style.display = 'block';
      instruction.style.display = 'block';
      divider.style.display = 'block';
      
      // Анимация появления
      setTimeout(() => {
        fieldPanel.style.height = '30vh';
        videoContainer.style.height = '70vh';
        divider.style.top = 'calc(70vh - 2px)';
      }, 10);
      
      console.log('Схема поля показана');
    }

    // Скрытие схемы поля
    function hideField() {
      // Анимация скрытия
      fieldPanel.style.height = '0';
      
      setTimeout(() => {
        fieldPanel.style.display = 'none';
        instruction.style.display = 'none';
        divider.style.display = 'none';
        videoContainer.style.height = '100vh';
      }, 300);
      
      console.log('Схема поля скрыта');
    }

    // Начало изменения размера
    function startResize(e) {
      isResizing = true;
      startHeight = parseInt(videoContainer.style.height) || 70;
      startY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY;
      
      document.addEventListener('mousemove', resize);
      document.addEventListener('touchmove', resizeTouch);
      document.addEventListener('mouseup', stopResize);
      document.addEventListener('touchend', stopResize);
    }

    // Изменение размера (мышь)
    function resize(e) {
      if (!isResizing) return;
      
      const deltaY = startY - e.clientY;
      const newHeightPercent = startHeight + (deltaY / window.innerHeight) * 100;
      
      // Ограничиваем высоту
      const clampedHeight = Math.max(minVideoHeight, Math.min(newHeightPercent, maxVideoHeight));
      
      videoContainer.style.height = clampedHeight + 'vh';
      fieldPanel.style.height = (100 - clampedHeight) + 'vh';
      divider.style.top = `calc(${clampedHeight}vh - 2px)`;
    }

    // Изменение размера (тач)
    function resizeTouch(e) {
      if (!isResizing || e.touches.length !== 1) return;
      
      const touch = e.touches[0];
      const deltaY = startY - touch.clientY;
      const newHeightPercent = startHeight + (deltaY / window.innerHeight) * 100;
      
      // Ограничиваем высоту
      const clampedHeight = Math.max(minVideoHeight, Math.min(newHeightPercent, maxVideoHeight));
      
      videoContainer.style.height = clampedHeight + 'vh';
      fieldPanel.style.height = (100 - clampedHeight) + 'vh';
      divider.style.top = `calc(${clampedHeight}vh - 2px)`;
    }

    // Остановка изменения размера
    function stopResize() {
      isResizing = false;
      document.removeEventListener('mousemove', resize);
      document.removeEventListener('touchmove', resizeTouch);
      document.removeEventListener('mouseup', stopResize);
      document.removeEventListener('touchend', stopResize);
    }

    // Начало записи
    function startRecording() {
      if (isRecording) return;
      
      isRecording = true;
      recordingStartTime = Date.now();
      events = [];
      
      // Показываем индикаторы
      recordingIndicator.style.display = 'flex';
      recordingTimer.style.display = 'block';
      
      // Обновляем кнопки
      startBtn.style.display = 'none';
      stopBtn.style.display = 'block';
      
      // Запускаем таймер
      updateTimer();
      timerInterval = setInterval(updateTimer, 1000);
      
      console.log('Запись начата в', new Date().toLocaleTimeString());
    }

    // Остановка записи
    function stopRecording() {
      if (!isRecording) return;
      
      isRecording = false;
      
      // Останавливаем таймер
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      
      // Скрываем индикаторы
      recordingIndicator.style.display = 'none';
      recordingTimer.style.display = 'none';
      
      // Показываем схему
      showField();
      
      console.log('Запись остановлена. Событий:', events.length);
    }

    // Обработчики кнопок
    startBtn.addEventListener('click', startRecording);
    stopBtn.addEventListener('click', stopRecording);

    // Обработчики для схемы
    fieldContainer.addEventListener('click', handleFieldClick);
    fieldContainer.addEventListener('touchstart', handleFieldClick);
    closeFieldBtn.addEventListener('click', hideField);

    // Обработчики для разделителя
    divider.addEventListener('mousedown', startResize);
    divider.addEventListener('touchstart', startResize);

    // Проверяем, когда видео готово
    function checkVideoReady() {
      window.addEventListener('message', (event) => {
        try {
          const data = JSON.parse(event.data);
          if (data.event === 'onReady') {
            startBtn.disabled = false;
          }
        } catch (e) {}
      });
      
      setTimeout(() => {
        startBtn.disabled = false;
      }, 3000);
    }

    // Запускаем проверку
    checkVideoReady();
  </script>
</body>
</html>
