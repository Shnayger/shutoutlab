<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>–ê–Ω–∞–ª–∏–∑ –º–∞—Ç—á–∞</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* –°–±—Ä–æ—Å */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background: #000;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* –≠–∫—Ä–∞–Ω –ø–æ–≤–æ—Ä–æ—Ç–∞ */
    #rotateScreen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
      padding: 20px;
      background: #111;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–≤–∏–¥–µ–æ) */
    #mainInterface {
      display: none;
      height: 100vh;
      position: relative;
    }

    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ */
    #recordingIndicator {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(198, 40, 40, 0.9);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      z-index: 50;
      display: none;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .recordingDot {
      width: 10px;
      height: 10px;
      background: #ff4444;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 0.3; }
      50% { opacity: 1; }
      100% { opacity: 0.3; }
    }

    /* –¢–∞–π–º–µ—Ä –∑–∞–ø–∏—Å–∏ */
    #recordingTimer {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      z-index: 50;
      display: none;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* –í–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    #videoContainer {
      width: 100%;
      height: 100%;
      background: #000;
      position: relative;
    }

    #videoFrame {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }

    /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 40;
    }

    .control-btn {
      padding: 14px 28px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      color: white;
      min-width: 140px;
      transition: all 0.2s;
    }

    #startBtn { 
      background: linear-gradient(135deg, #2e7d32, #4caf50);
    }

    #startBtn:disabled {
      background: #555;
      cursor: not-allowed;
      opacity: 0.6;
    }

    #stopBtn { 
      background: linear-gradient(135deg, #c62828, #f44336);
      display: none;
    }

    .control-btn:active:not(:disabled) {
      transform: scale(0.95);
    }

    /* –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å—Ö–µ–º–µ */
    #showFieldBtn {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 6px 16px;
      font-size: 12px;
      cursor: pointer;
      z-index: 45;
      backdrop-filter: blur(10px);
      transition: all 0.2s;
      display: none;
    }

    #showFieldBtn:active {
      transform: translateX(-50%) scale(0.95);
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ —Å –Ω–∞—Ö–ª–µ—Å—Ç–æ–º (iOS —Å—Ç–∏–ª—å) */
    #iosCarousel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: none;
      z-index: 200;
      overflow: hidden;
    }

    /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –∫–∞—Ä—É—Å–µ–ª—å */
    #verticalCarousel {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      will-change: transform;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
    .app-card {
      position: absolute;
      width: 90%;
      height: 85%;
      left: 5%;
      background: #1a1a1a;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      transition: transform 0.4s, opacity 0.4s;
      display: flex;
      flex-direction: column;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .card-header {
      height: 50px;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 500;
      color: white;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
    }

    /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç—å */
    .close-btn {
      position: absolute;
      right: 15px;
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .close-btn:active {
      background: rgba(255, 255, 255, 0.1);
    }

    /* –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .card-content {
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ */
    #videoCard {
      background: #000;
      transform: translateY(10%);
      opacity: 0.9;
      z-index: 1;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ö–µ–º—ã (–∞–∫—Ç–∏–≤–Ω–∞—è) */
    #fieldCard {
      background: #1a1a1a;
      transform: translateY(0);
      opacity: 1;
      z-index: 2;
    }

    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∫—Ä–æ–ª–ª–∞ */
    #scrollIndicator {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      z-index: 300;
    }

    .scroll-dot {
      width: 6px;
      height: 6px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transition: all 0.3s;
    }

    .scroll-dot.active {
      background: white;
      transform: scale(1.2);
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ö–µ–º—ã —Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–µ–π */
    #fieldImageContainer {
      width: 100%;
      height: 100%;
      position: relative;
      touch-action: none;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0d47a1; /* –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω –∫–∞–∫ —É –ª—å–¥–∞ */
    }

    /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ö–µ–º—ã - –¥–µ–ª–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º */
    #fieldImage {
      width: auto;
      height: 100%;
      max-width: 100%;
      object-fit: contain;
      transform: rotate(90deg); /* –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ 90 –≥—Ä–∞–¥—É—Å–æ–≤ */
      transform-origin: center;
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none; /* –ö–ª–∏–∫–∏ –±—É–¥—É—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É */
    }

    /* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –±–µ–∑ –æ–±—Ä–µ–∑–∫–∏ */
    #fieldImage.keep-aspect {
      width: 100%;
      height: auto;
      max-height: 100%;
      object-fit: contain;
      transform: rotate(90deg);
    }

    /* –ê–∫—Ç–∏–≤–Ω–∞—è —Ç–æ—á–∫–∞ –Ω–∞ —Å—Ö–µ–º–µ */
    .marker-point {
      position: absolute;
      width: 24px;
      height: 24px;
      background: #FF0000;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.9);
      transform: translate(-50%, -50%);
      z-index: 100;
      cursor: move;
      transition: transform 0.1s;
      pointer-events: auto;
    }

    .marker-point.dragging {
      transform: translate(-50%, -50%) scale(1.3);
      z-index: 101;
      box-shadow: 0 0 25px rgba(255, 0, 0, 1);
    }

    /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞ —Å—Ö–µ–º–µ */
    #fieldInstruction {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      z-index: 45;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-align: center;
      max-width: 90%;
      white-space: nowrap;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—É—Å–µ–ª–∏ */
    @keyframes slideUp {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    #iosCarousel.show {
      display: block;
      animation: slideUp 0.3s ease-out;
    }
  </style>
</head>
<body>
  <!-- –≠–∫—Ä–∞–Ω –ø–æ–≤–æ—Ä–æ—Ç–∞ -->
  <div id="rotateScreen">
    <svg viewBox="0 0 24 24" fill="white" width="60" height="60">
      <path d="M19 12h-1.5c-.82 0-1.5-.68-1.5-1.5V5.5C16 4.67 16.67 4 17.5 4H19c.83 0 1.5.67 1.5 1.5v3.5c0 .83-.67 1.5-1.5 1.5H1L1.01 21c0 1.1.89 2 2 2H21c1.1 0 2-.9 2-2L22.99 14H19zm-5.5-9H8.5V8h4V4zm6 14H2v2h18v-2z"/>
    </svg>
    <p style="margin-top: 20px;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ.</p>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–≤–∏–¥–µ–æ) -->
  <div id="mainInterface">
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ -->
    <div id="recordingIndicator">
      <div class="recordingDot"></div>
      <span>–ò–¥–µ—Ç –∑–∞–ø–∏—Å—å</span>
    </div>

    <!-- –¢–∞–π–º–µ—Ä –∑–∞–ø–∏—Å–∏ -->
    <div id="recordingTimer">00:00:00</div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å—Ö–µ–º–µ -->
    <button id="showFieldBtn">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å—Ö–µ–º–µ</button>

    <!-- –í–∏–¥–µ–æ -->
    <div id="videoContainer">
      <iframe id="videoFrame" allowfullscreen></iframe>
    </div>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <div id="controls">
      <button id="startBtn" class="control-btn" disabled>–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
      <button id="stopBtn" class="control-btn">–°—Ç–æ–ø</button>
    </div>
  </div>

  <!-- iOS —Å—Ç–∏–ª—å –∫–∞—Ä—É—Å–µ–ª–∏ (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª —Å –Ω–∞—Ö–ª–µ—Å—Ç–æ–º) -->
  <div id="iosCarousel">
    <!-- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –∫–∞—Ä—É—Å–µ–ª—å -->
    <div id="verticalCarousel">
      <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ -->
      <div class="app-card" id="videoCard">
        <div class="card-header">
          <span>üé• –í–∏–¥–µ–æ –º–∞—Ç—á–∞</span>
          <button class="close-btn" onclick="hideCarousel()">√ó</button>
        </div>
        <div class="card-content">
          <!-- –í–∏–¥–µ–æ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
      </div>

      <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ö–µ–º—ã -->
      <div class="app-card" id="fieldCard">
        <div class="card-header">
          <span>üèí –°—Ö–µ–º–∞ –ø–æ–ª—è</span>
          <button class="close-btn" onclick="hideCarousel()">√ó</button>
        </div>
        <div class="card-content">
          <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ö–µ–º—ã -->
          <div id="fieldImageContainer">
            <!-- –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–£ –°–°–´–õ–ö–£ –ù–ê –í–ê–®–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï -->
            <!-- –ü—Ä–∏–º–µ—Ä: https://raw.githubusercontent.com/username/repo/main/hockey-field.jpg -->
            <img id="fieldImage" src="1769507389.png" alt="–•–æ–∫–∫–µ–π–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞" class="keep-aspect">
            <div id="fieldInstruction">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–æ–ª–µ, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ—á–∫—É. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–æ—á–∫—É, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å</div>
            <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è —Ç–æ—á–∫–∞ -->
          </div>
        </div>
      </div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∫—Ä–æ–ª–ª–∞ -->
    <div id="scrollIndicator">
      <div class="scroll-dot" data-index="0"></div>
      <div class="scroll-dot active" data-index="1"></div>
    </div>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    if (window.Telegram?.WebApp) {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
    }

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const rotateScreen = document.getElementById('rotateScreen');
    const mainInterface = document.getElementById('mainInterface');
    const iosCarousel = document.getElementById('iosCarousel');
    const verticalCarousel = document.getElementById('verticalCarousel');
    const videoCard = document.getElementById('videoCard');
    const fieldCard = document.getElementById('fieldCard');
    const videoFrame = document.getElementById('videoFrame');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const showFieldBtn = document.getElementById('showFieldBtn');
    const fieldImageContainer = document.getElementById('fieldImageContainer');
    const fieldImage = document.getElementById('fieldImage');
    const fieldInstruction = document.getElementById('fieldInstruction');
    const recordingIndicator = document.getElementById('recordingIndicator');
    const recordingTimer = document.getElementById('recordingTimer');
    const scrollDots = document.querySelectorAll('.scroll-dot');

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    let isRecording = false;
    let recordingStartTime = null;
    let timerInterval = null;
    let events = [];
    
    // –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ—á–∫–æ–π
    let currentMarker = null;
    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    let markerStartX = 0;
    let markerStartY = 0;
    
    // –î–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞
    let isScrolling = false;
    let startTouchY = 0;
    let startCarouselY = 0;
    let currentIndex = 1; // 0 = –≤–∏–¥–µ–æ, 1 = —Å—Ö–µ–º–∞
    let cardHeight = 0;
    let cardSpacing = 20; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏

    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
    const urlParams = new URLSearchParams(window.location.search);
    const videoUrl = urlParams.get('video');
    const date = urlParams.get('date');
    const opponent = urlParams.get('opponent');
    const iceTime = urlParams.get('ice_time');

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ
    if (videoUrl) {
      let finalUrl = videoUrl;
      
      // YouTube
      if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
        let videoId;
        if (videoUrl.includes('youtu.be/')) {
          videoId = videoUrl.split('youtu.be/')[1].split('?')[0];
        } else {
          videoId = videoUrl.split('v=')[1]?.split('&')[0];
        }
        if (videoId) {
          finalUrl = `https://www.youtube.com/embed/${videoId}?autoplay=0&rel=0&controls=1&enablejsapi=1`;
        }
      }
      // Vimeo
      else if (videoUrl.includes('vimeo.com')) {
        const vimeoId = videoUrl.split('/').pop();
        finalUrl = `https://player.vimeo.com/video/${vimeoId}?autoplay=0`;
      }
      
      videoFrame.src = finalUrl;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
    function checkOrientation() {
      const isLandscape = window.innerWidth > window.innerHeight;
      rotateScreen.style.display = isLandscape ? 'none' : 'flex';
      mainInterface.style.display = isLandscape ? 'block' : 'none';
    }

    window.addEventListener('resize', checkOrientation);
    checkOrientation();

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
    function formatTime(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      
      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
    function updateTimer() {
      if (recordingStartTime) {
        const elapsed = Date.now() - recordingStartTime;
        recordingTimer.textContent = formatTime(elapsed);
      }
    }

    // –ü–∞—É–∑–∞ –≤–∏–¥–µ–æ
    function pauseVideo() {
      if (videoFrame.contentWindow) {
        try {
          videoFrame.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
        } catch (e) {
          console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ –Ω–∞ –ø–∞—É–∑—É');
        }
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—É—Å–µ–ª—å
    function showCarousel() {
      // –°—Ç–∞–≤–∏–º –≤–∏–¥–µ–æ –Ω–∞ –ø–∞—É–∑—É
      pauseVideo();
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—É—Å–µ–ª—å
      iosCarousel.classList.add('show');
      mainInterface.style.display = 'none';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
      updateCardPositions();
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å—Ö–µ–º–µ" –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
      showFieldBtn.style.display = 'block';
    }

    // –°–∫—Ä—ã—Ç—å –∫–∞—Ä—É—Å–µ–ª—å
    function hideCarousel() {
      iosCarousel.classList.remove('show');
      mainInterface.style.display = 'block';
    }

    // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
    function updateCardPositions() {
      cardHeight = window.innerHeight * 0.85; // 85% –æ—Ç –≤—ã—Å–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞
      
      // –ü–æ–∑–∏—Ü–∏—è –¥–ª—è –≤–∏–¥–µ–æ (–Ω–∏–∂–µ)
      videoCard.style.transform = `translateY(${cardHeight + cardSpacing}px)`;
      videoCard.style.opacity = '0.7';
      videoCard.style.zIndex = '1';
      
      // –ü–æ–∑–∏—Ü–∏—è –¥–ª—è —Å—Ö–µ–º—ã (—Å–≤–µ—Ä—Ö—É)
      fieldCard.style.transform = 'translateY(0)';
      fieldCard.style.opacity = '1';
      fieldCard.style.zIndex = '2';
      
      // –ü–æ–∑–∏—Ü–∏—è –∫–∞—Ä—É—Å–µ–ª–∏
      verticalCarousel.style.transform = `translateY(${-currentIndex * (cardHeight + cardSpacing)}px)`;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
      scrollDots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentIndex);
      });
    }

    // –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ
    function goToCard(index) {
      currentIndex = Math.max(0, Math.min(index, 1));
      verticalCarousel.style.transform = `translateY(${-currentIndex * (cardHeight + cardSpacing)}px)`;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –∏ —Å—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
      if (currentIndex === 0) {
        // –í–∏–¥–µ–æ –∞–∫—Ç–∏–≤–Ω–æ
        videoCard.style.transform = 'translateY(0)';
        videoCard.style.opacity = '1';
        videoCard.style.zIndex = '2';
        
        fieldCard.style.transform = `translateY(${cardHeight + cardSpacing}px)`;
        fieldCard.style.opacity = '0.7';
        fieldCard.style.zIndex = '1';
      } else {
        // –°—Ö–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞
        fieldCard.style.transform = 'translateY(0)';
        fieldCard.style.opacity = '1';
        fieldCard.style.zIndex = '2';
        
        videoCard.style.transform = `translateY(${cardHeight + cardSpacing}px)`;
        videoCard.style.opacity = '0.7';
        videoCard.style.zIndex = '1';
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
      scrollDots.forEach((dot, i) => {
        dot.classList.toggle('active', i === currentIndex);
      });
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–∫–∏ —Å —É—á–µ—Ç–æ–º –ø–æ–≤–µ—Ä–Ω—É—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    function createMarker(x, y) {
      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Ç–æ—á–∫—É, –µ—Å–ª–∏ –µ—Å—Ç—å
      if (currentMarker) {
        currentMarker.remove();
      }
      
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Ç–æ—á–∫—É
      currentMarker = document.createElement('div');
      currentMarker.className = 'marker-point';
      
      // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å —É—á–µ—Ç–æ–º –ø–æ–≤–æ—Ä–æ—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      const containerRect = fieldImageContainer.getBoundingClientRect();
      const imageRect = fieldImage.getBoundingClientRect();
      
      // –¢–∞–∫ –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ 90 –≥—Ä–∞–¥—É—Å–æ–≤, –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
      const correctedX = x;
      const correctedY = y;
      
      currentMarker.style.left = correctedX + 'px';
      currentMarker.style.top = correctedY + 'px';
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
      currentMarker.addEventListener('mousedown', startDrag);
      currentMarker.addEventListener('touchstart', startDragTouch);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ö–µ–º—É
      fieldImageContainer.appendChild(currentMarker);
      
      console.log('–¢–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –≤ –ø–æ–∑–∏—Ü–∏–∏:', {x: correctedX, y: correctedY});
    }

    // –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è (–º—ã—à—å)
    function startDrag(e) {
      e.preventDefault();
      e.stopPropagation();
      
      isDragging = true;
      currentMarker.classList.add('dragging');
      
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      markerStartX = currentMarker.offsetLeft;
      markerStartY = currentMarker.offsetTop;
      
      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', stopDrag);
    }

    // –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è (—Ç–∞—á)
    function startDragTouch(e) {
      e.preventDefault();
      e.stopPropagation();
      
      if (e.touches.length !== 1) return;
      
      isDragging = true;
      currentMarker.classList.add('dragging');
      
      const touch = e.touches[0];
      dragStartX = touch.clientX;
      dragStartY = touch.clientY;
      markerStartX = currentMarker.offsetLeft;
      markerStartY = currentMarker.offsetTop;
      
      document.addEventListener('touchmove', dragTouch);
      document.addEventListener('touchend', stopDragTouch);
    }

    // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ (–º—ã—à—å)
    function drag(e) {
      if (!isDragging) return;
      
      const deltaX = e.clientX - dragStartX;
      const deltaY = e.clientY - dragStartY;
      
      const newX = markerStartX + deltaX;
      const newY = markerStartY + deltaY;
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
      const containerRect = fieldImageContainer.getBoundingClientRect();
      const maxX = containerRect.width;
      const maxY = containerRect.height;
      
      const clampedX = Math.max(0, Math.min(newX, maxX));
      const clampedY = Math.max(0, Math.min(newY, maxY));
      
      currentMarker.style.left = clampedX + 'px';
      currentMarker.style.top = clampedY + 'px';
    }

    // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ (—Ç–∞—á)
    function dragTouch(e) {
      if (!isDragging || e.touches.length !== 1) return;
      
      const touch = e.touches[0];
      const deltaX = touch.clientX - dragStartX;
      const deltaY = touch.clientY - dragStartY;
      
      const newX = markerStartX + deltaX;
      const newY = markerStartY + deltaY;
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
      const containerRect = fieldImageContainer.getBoundingClientRect();
      const maxX = containerRect.width;
      const maxY = containerRect.height;
      
      const clampedX = Math.max(0, Math.min(newX, maxX));
      const clampedY = Math.max(0, Math.min(newY, maxY));
      
      currentMarker.style.left = clampedX + 'px';
      currentMarker.style.top = clampedY + 'px';
    }

    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è (–º—ã—à—å)
    function stopDrag() {
      isDragging = false;
      if (currentMarker) {
        currentMarker.classList.remove('dragging');
      }
      
      document.removeEventListener('mousemove', drag);
      document.removeEventListener('mouseup', stopDrag);
      
      console.log('–¢–æ—á–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ –ø–æ–∑–∏—Ü–∏—é:', {
        x: currentMarker.offsetLeft,
        y: currentMarker.offsetTop
      });
    }

    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è (—Ç–∞—á)
    function stopDragTouch() {
      isDragging = false;
      if (currentMarker) {
        currentMarker.classList.remove('dragging');
      }
      
      document.removeEventListener('touchmove', dragTouch);
      document.removeEventListener('touchend', stopDragTouch);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Å—Ö–µ–º–µ
    function handleFieldClick(e) {
      // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –ø–æ —Ç–æ—á–∫–µ, –Ω–µ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
      if (e.target.classList.contains('marker-point')) {
        return;
      }
      
      // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–∫–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
      const rect = fieldImageContainer.getBoundingClientRect();
      let x, y;
      
      if (e.type === 'click' || e.type === 'mousedown') {
        x = e.clientX - rect.left;
        y = e.clientY - rect.top;
      } else if (e.type === 'touchstart') {
        const touch = e.touches[0];
        x = touch.clientX - rect.left;
        y = touch.clientY - rect.top;
      }
      
      // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø–µ—Ä–µ–º–µ—â–∞–µ–º —Ç–æ—á–∫—É
      if (currentMarker) {
        // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–æ—á–∫—É
        currentMarker.style.left = x + 'px';
        currentMarker.style.top = y + 'px';
        console.log('–¢–æ—á–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤:', {x, y});
      } else {
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Ç–æ—á–∫—É
        createMarker(x, y);
      }
    }

    // –ù–∞—á–∞–ª–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞
    function startVerticalScroll(e) {
      isScrolling = true;
      startTouchY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
      startCarouselY = parseInt(verticalCarousel.style.transform.replace('translateY(', '').replace('px)', '')) || 0;
      
      if (e.type === 'touchstart') {
        document.addEventListener('touchmove', moveVerticalScroll);
        document.addEventListener('touchend', endVerticalScroll);
      } else {
        document.addEventListener('mousemove', moveVerticalScroll);
        document.addEventListener('mouseup', endVerticalScroll);
      }
    }

    // –î–≤–∏–∂–µ–Ω–∏–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞
    function moveVerticalScroll(e) {
      if (!isScrolling) return;
      
      const currentY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
      const deltaY = currentY - startTouchY;
      const newPosition = startCarouselY + deltaY;
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª
      const maxPosition = 0;
      const minPosition = -(cardHeight + cardSpacing);
      const clampedPosition = Math.max(minPosition, Math.min(newPosition, maxPosition));
      
      verticalCarousel.style.transform = `translateY(${clampedPosition}px)`;
    }

    // –ö–æ–Ω–µ—Ü –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞
    function endVerticalScroll(e) {
      if (!isScrolling) return;
      
      isScrolling = false;
      
      const currentY = e.type === 'touchend' ? e.changedTouches[0].clientY : e.clientY;
      const deltaY = currentY - startTouchY;
      const velocity = deltaY / 300; // –ü—Ä–æ—Å—Ç–∞—è "—Ñ–∏–∑–∏–∫–∞"
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫ –∫–∞–∫–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ –ø–µ—Ä–µ–π—Ç–∏
      let targetIndex = currentIndex;
      if (Math.abs(deltaY) > 50 || Math.abs(velocity) > 0.2) {
        if (deltaY > 0 || velocity > 0) {
          targetIndex = Math.max(0, currentIndex - 1); // –í–≤–µ—Ä—Ö
        } else {
          targetIndex = Math.min(1, currentIndex + 1); // –í–Ω–∏–∑
        }
      }
      
      // –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ
      goToCard(targetIndex);
      
      // –£–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
      document.removeEventListener('touchmove', moveVerticalScroll);
      document.removeEventListener('touchend', endVerticalScroll);
      document.removeEventListener('mousemove', moveVerticalScroll);
      document.removeEventListener('mouseup', endVerticalScroll);
    }

    // –ù–∞—á–∞–ª–æ –∑–∞–ø–∏—Å–∏
    function startRecording() {
      if (isRecording) return;
      
      isRecording = true;
      recordingStartTime = Date.now();
      events = [];
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
      recordingIndicator.style.display = 'flex';
      recordingTimer.style.display = 'block';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
      startBtn.style.display = 'none';
      stopBtn.style.display = 'block';
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
      updateTimer();
      timerInterval = setInterval(updateTimer, 1000);
      
      console.log('–ó–∞–ø–∏—Å—å –Ω–∞—á–∞—Ç–∞ –≤', new Date().toLocaleTimeString());
    }

    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏
    function stopRecording() {
      if (!isRecording) return;
      
      isRecording = false;
      
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      
      // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
      recordingIndicator.style.display = 'none';
      recordingTimer.style.display = 'none';
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—É—Å–µ–ª—å —Å–æ —Å—Ö–µ–º–æ–π
      showCarousel();
      
      console.log('–ó–∞–ø–∏—Å—å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –°–æ–±—ã—Ç–∏–π:', events.length);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
    startBtn.addEventListener('click', startRecording);
    stopBtn.addEventListener('click', stopRecording);
    showFieldBtn.addEventListener('click', showCarousel);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å—Ö–µ–º—ã
    fieldImageContainer.addEventListener('click', handleFieldClick);
    fieldImageContainer.addEventListener('touchstart', handleFieldClick);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞
    iosCarousel.addEventListener('touchstart', startVerticalScroll);
    iosCarousel.addEventListener('mousedown', startVerticalScroll);

    // –ö–ª–∏–∫ –ø–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º
    scrollDots.forEach(dot => {
      dot.addEventListener('click', () => {
        const index = parseInt(dot.getAttribute('data-index'));
        goToCard(index);
      });
    });

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–æ–≥–¥–∞ –≤–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ
    function checkVideoReady() {
      window.addEventListener('message', (event) => {
        try {
          const data = JSON.parse(event.data);
          if (data.event === 'onReady') {
            startBtn.disabled = false;
          }
        } catch (e) {}
      });
      
      setTimeout(() => {
        startBtn.disabled = false;
      }, 3000);
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
    checkVideoReady();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', () => {
      updateCardPositions();
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø—É—Ç—å)
      // fieldImage.src = 'https://raw.githubusercontent.com/username/repo/main/hockey-field.jpg';
    });
  </script>
</body>
</html>

